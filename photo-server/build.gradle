plugins {
	id 'io.spring.dependency-management' version '1.1.0'
	id 'org.springdoc.openapi-gradle-plugin' version "1.6.0"
	id 'org.springframework.boot' version '3.1.0'
}

dependencies{
	implementation project(":stapledon-auth")
	integrationImplementation project(":stapledon-auth")
}

springBoot {
	buildInfo()
}

tasks.register("updateApiDocs") {
	copy {
		from 'build/openapi.json'
		into "../docs"
	}
}

tasks.named("build") {
	finalizedBy("updateApiDocs")
}

configurations {
	compileOnly {
		extendsFrom annotationProcessor
	}
}

test {
	finalizedBy jacocoTestReport
}

jacocoTestReport {
	dependsOn test
}



bootRun {
	environment("SPRING_DATASOURCE_URL", "jdbc:tc:postgresql:13.9://localhost/testdb?TC_TMPFS=/var/lib/postgresql/data:rw")
	environment("SPRING_DATASOURCE_DRIVERCLASSNAME", "org.testcontainers.jdbc.ContainerDatabaseDriver")
}
bootJar {
	mainClass = "org.stapledon.PhotoOrganizerApplication"
	enabled = true
}

jar {
	enabled = true
}